<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
  <title>Hit Target Math Game</title>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://preview.babylonjs.com/gui/babylon.gui.js"></script>
  <style>
    html, body {
        overflow: hidden;
        width   : 100%;
        height  : 100%;
        margin  : 0;
        padding : 0;
    }

    #renderCanvas {
        width   : 100%;
        height  : 100%;
        touch-action: none;
    }
  </style>
</head>
<body>
  <canvas id="renderCanvas"></canvas>
  <script>

    window.addEventListener('DOMContentLoaded', function(){   // Start game when DOM loads

      var render = 0;

      var canvas = document.getElementById('renderCanvas');   // get the canvas DOM element
      var engine = new BABYLON.Engine(canvas, true);          // load the 3D engine

      var createLogin = function () {                         // function that returns the login scene

        var scene = new BABYLON.Scene(engine);                // create the scene

				var camera = new BABYLON.UniversalCamera("camera1", new BABYLON.Vector3(0, 0, -10), scene);
                                                              // creates camera pointed at the scene
				camera.setTarget(BABYLON.Vector3.Zero());             // targets the camera to scene origin

				camera.attachControl(canvas, true);                   // attaches the camera to the canvas

				// GUI
				var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");

        var input = new BABYLON.GUI.InputText();
        input.width = "180px";
        input.maxWidth = 0.15;
        input.height = "35px";
        input.color = "black";
        input.background = "lightyellow";
        input.thickness = 0.15;
        input.focusedBackground = "white";
        advancedTexture.addControl(input);

        input.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
        input.top = "-110px";

        var input2 = new BABYLON.GUI.InputPassword();
        input2.width = "180px";
        input2.maxwidth = 0.15;
        input2.height = "35px";
        input2.color = "black";
        input2.background = "lightyellow";
        input2.thickness = 0.15;
        input2.focusedBackground = "white";
        advancedTexture.addControl(input2);

        input2.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
        input2.top = "-30px";

        var text1 = new BABYLON.GUI.TextBlock();
        text1.text = "Password";
        text1.color = "saddlebrown";
        text1.height = "43px";
        text1.fontFamily = "Blackadder ITC";
        text1.fontStyle = "italic";
        text1.fontSize = 35;
        advancedTexture.addControl(text1);

        text1.top = "-65px";
        text1.left = "-45px";

        var text2 = new BABYLON.GUI.TextBlock();
        text2.text = "Username";
        text2.color = "saddlebrown";
        text2.height = "43px";
        text2.fontFamily = "Blackadder ITC";
        text2.fontStyle = "italic";
        text2.fontSize = 35;
        advancedTexture.addControl(text2);

        text2.top = "-140px";
        text2.left = "-43px";

        var button = BABYLON.GUI.Button.CreateImageWithCenterTextButton("log_butt", "Login", "login-button.png");
        button.height = "90px";
        button.width = "290px";
        button.fontFamily = "Blackadder ITC";
        button.fontStyle = "italic";
        button.fontSize = 36;
        button.color = "gold";
        button.thickness = 0;
        advancedTexture.addControl(button);

        button.top = "40px";
        //button.left = "125px";

        button.onPointerClickObservable.add(function() {
          render = 1;
        });

        var background = new BABYLON.Layer("back", "login.png", scene);
        background.isBackground = true;

			  return scene;

      };

      var createMenu = function () {

  			// This creates a basic Babylon Scene object (non-mesh)
  			var scene = new BABYLON.Scene(engine);

  			// This creates and positions a free camera (non-mesh)
  			var camera = new BABYLON.Camera("menu cam",BABYLON.Vector3.Zero());

  			// This attaches the camera to the canvas
  			camera.attachControl(canvas, true);

  			// GUI
  			var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("ui1");

  			var panel1 = new BABYLON.GUI.StackPanel();
  			panel1.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
  			panel1.top = -200;
  			advancedTexture.addControl(panel1);
  			var button1 = BABYLON.GUI.Button.CreateImageWithCenterTextButton("PLAYbut", "Play", "menu-button.png");
    		button1.height = "90px";
    		button1.width = "290px";
    		button1.fontFamily = "Blackadder ITC";
    		button1.fontStyle = "italic";
    		button1.fontSize = 36;
    		button1.color = "gold";
    		button1.thickness = 0;
  			button1.onPointerUpObservable.add(function() {
  			   render = 2;
  			});
  			panel1.addControl(button1);

  			var panel2 = new BABYLON.GUI.StackPanel();
  			panel2.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
  			panel2.top = -100;
  			advancedTexture.addControl(panel2);
  			var button2 = BABYLON.GUI.Button.CreateImageWithCenterTextButton("STATSbut", "Stats", "menu-button.png");
    		button2.height = "90px";
    		button2.width = "290px";
    		button2.fontFamily = "Blackadder ITC";
    		button2.fontStyle = "italic";
    		button2.fontSize = 36;
    		button2.color = "gold";
    		button2.thickness = 0;
  			button2.onPointerUpObservable.add(function() {
  				button2.background = "blue";
  			});
  			panel2.addControl(button2);

        var panel3 = new BABYLON.GUI.StackPanel();
  			panel3.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
  			panel3.top = 0;
  			advancedTexture.addControl(panel3);
  			var button3 = BABYLON.GUI.Button.CreateImageWithCenterTextButton("HOW2but", "How to Play", "menu-button.png");
    		button3.height = "90px";
    		button3.width = "290px";
    		button3.fontFamily = "Blackadder ITC";
    		button3.fontStyle = "italic";
    		button3.fontSize = 36;
    		button3.color = "gold";
    		button3.thickness = 0;
  			button3.onPointerUpObservable.add(function() {
  				button3.background = "blue";
  			});
  			panel3.addControl(button3);

  			var panel4 = new BABYLON.GUI.StackPanel();
  			panel4.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
  			panel4.top = 100;
  			advancedTexture.addControl(panel4);
  			var button4 = BABYLON.GUI.Button.CreateImageWithCenterTextButton("SETTINGSbut", "Settings", "menu-button.png");
    		button4.height = "90px";
    		button4.width = "290px";
    		button4.fontFamily = "Blackadder ITC";
    		button4.fontStyle = "italic";
    		button4.fontSize = 36;
    		button4.color = "gold";
    		button4.thickness = 0;
  			button4.onPointerUpObservable.add(function() {
  				button4.background = "blue";
  			});
  			panel4.addControl(button4);

  			var panel5 = new BABYLON.GUI.StackPanel();
  			panel5.width = .2;
  			panel5.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
  			panel5.top = -300;
  			advancedTexture.addControl(panel5);
  			var button5 = BABYLON.GUI.Button.CreateImageWithCenterTextButton("LOGOUTbut", "Logout", "menu-button.png");
    		button5.height = "90px";
    		button5.width = "290px";
    		button5.fontFamily = "Blackadder ITC";
    		button5.fontStyle = "italic";
    		button5.fontSize = 36;
    		button5.color = "gold";
    		button5.thickness = 0;
  			button5.onPointerUpObservable.add(function() {
  				render = 0;
  			});
  			panel5.addControl(button5);

  			var panel6 = new BABYLON.GUI.StackPanel();
  			panel6.width = .2;
  			panel6.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
  			panel6.top = -300;
  			advancedTexture.addControl(panel6);
  			var button6 = BABYLON.GUI.Button.CreateImageWithCenterTextButton("NAMEbut", "Account", "menu-button.png");
    		button6.height = "90px";
    		button6.width = "290px";
    		button6.fontFamily = "Blackadder ITC";
    		button6.fontStyle = "italic";
    		button6.fontSize = 36;
    		button6.color = "gold";
    		button6.thickness = 0;
  			button6.onPointerUpObservable.add(function() {
  				button6.background = "blue";
  			});
  			panel6.addControl(button6);

  		  var background = new BABYLON.Layer("back", "menu.png", scene);
  		  background.isBackground = true;

  			return scene;

      };


      var createGame = function () {

        // Creates basic babylon scene
      	var scene = new BABYLON.Scene(engine);
        // Sets a camera facing the scene
      	var camera = new BABYLON.UniversalCamera("camera1", new BABYLON.Vector3(0, 0, -10), scene);
      	// GUI fullscreen
      	var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("ui2");

        // var foreground = new BABYLON.Layer("fore", "hit-target-castle-facade-concept-high-res.png", scene);
        // foreground.isBackground = false;

      	//><><><><><><><><><>< START OF NUMBER LINE CODE ><><><><><><><><><><

      	var line = new BABYLON.GUI.Line();
      	line.x1 = 100;
      	line.y1 = 50;
      	line.x2 = 1700;
      	line.y2 = 50;
      	line.lineWidth = 60;
      	line.dash = [4,100];
      	line.color = "black";
      	advancedTexture.addControl(line);

      	var line2 = new BABYLON.GUI.Line();
      	line2.x1 = 100;
      	line2.y1 = 50;
      	line2.x2 = 1660;
      	line2.y2 = 50;
      	line2.lineWidth = 30;
      	line2.dash = [2,50];
      	line2.color = "black";
      	advancedTexture.addControl(line2);

      	var line3 = new BABYLON.GUI.Line();
      	line3.x1 = 100;
      	line3.y1 = 50;
      	line3.x2 = 1660;
      	line3.y2 = 50;
      	line3.lineWidth = 3;
      	//line3.dash = [2,50];
      	line3.color = "black";
      	advancedTexture.addControl(line3);

      	var line4 = new BABYLON.GUI.Line();
      	line4.x1 = 100;
      	line4.y1 = 50;
      	line4.x2 = 1660;
      	line4.y2 = 50;
      	line4.lineWidth = 10;
      	line4.dash = [1,12];
      	line4.color = "black";
      	advancedTexture.addControl(line4);
              // ><><><><><><><><><>< END OF NUMBER LINE CODE ><><><><><><><><><><

      	var text1 = new BABYLON.GUI.TextBlock();
      	text1.color = "black";
      	text1.height = "43px";
      	text1.fontFamily = "Arial";
      	text1.fontStyle = "bold";
      	text1.fontSize = 35;
      	text1.top = "100px";
      	text1.left = "-40px";
        text1.zIndex = 1;
      	advancedTexture.addControl(text1);

      	var text2 = new BABYLON.GUI.TextBlock();
      	text2.text = " x  ";
      	text2.color = "black";
      	text2.height = "43px";
      	text2.fontFamily = "Arial";
      	text2.fontStyle = "bold";
      	text2.fontSize = 35;
        text2.zIndex = 1;
      	text2.top = "100px";
      	text2.left = "-100px";
      	advancedTexture.addControl(text2);

        // Equals sign
      	var text3 = new BABYLON.GUI.TextBlock();
      	text3.text = " = ";
      	text3.color = "black";
      	text3.height = "43px";
      	text3.fontFamily = "Arial";
      	text3.fontStyle = "bold";
      	text3.fontSize = 35;
        text1.zIndex = 1;
      	text3.top = "105px";
      	text3.left = "30px";
      	advancedTexture.addControl(text3);

        // Answer numbers
      	var output = new BABYLON.GUI.TextBlock();
      	output.width = "180px";
      	output.maxWidth = 0.15;
      	output.height = "43px";
      	output.color = "black";
      	output.fontFamily = "Arial";
      	output.thickness = 0.15;
      	output.fontSize = 35;
      	output.fontStyle = "bold";
      	output.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
      	output.top = "100px";
      	output.left = "90px";
        output.zIndex = 1;
      	advancedTexture.addControl(output);

        // Range text
      	var text4 = new BABYLON.GUI.TextBlock();
      	text4.text = "Range";
      	text4.color = "black";
      	text4.height = "70px";
      	text4.width = "150px";
      	text4.fontFamily = "Arial";
      	text4.fontStyle = "bold";
      	text4.fontSize = 45;
      	text4.top = "79px";
      	text4.left = "-340px";
        text4.zIndex = 1;
      	advancedTexture.addControl(text4);

	var hitmarker_l = new BABYLON.GUI.TextBlock("lo", "Low");
	hitmarker_l.width = "200px";
	hitmarker_l.height = "100px";
	hitmarker_l.left = "-500px";
	hitmarker_l.top = "-345px";
	hitmarker_l.color = "red";
	hitmarker_l.fontSize = 60;
	hitmarker_l.alpha = 0;
	advancedTexture.addControl(hitmarker_l);

	var hitmarker_h = new BABYLON.GUI.TextBlock("hi", "High");
	hitmarker_h.width = "200px";
	hitmarker_h.height = "100px";
	hitmarker_h.left = "500px";
	hitmarker_h.top = "-345px";
	hitmarker_h.color = "red";
	hitmarker_h.fontSize = 60;
	hitmarker_h.alpha = 0;
	advancedTexture.addControl(hitmarker_h);

	var hitmarker_t = new BABYLON.GUI.TextBlock("tar", "Hit");
	hitmarker_t.width = "200px";
	hitmarker_t.height = "100px";
	hitmarker_t.left = "0px";
	hitmarker_t.top = "-345px";
	hitmarker_t.color = "green";
	hitmarker_t.fontSize = 60;
	hitmarker_t.alpha = 0;
	advancedTexture.addControl(hitmarker_t);
										   
        // Range numbers
      	var range = new BABYLON.GUI.TextBlock();
      	range.text = "[]";
      	range.color = "black";
      	range.height = "70px";
      	range.width = "190px";
      	range.fontFamily = "Arial";
      	range.fontStyle = "bold";
      	range.fontSize = 35;
      	range.top = "130px";
      	range.left = "-345px";
        range.zIndex = 1;
      	advancedTexture.addControl(range);

      	var param = "";
      	var rand_num1;
      	var rand_num2;
      	var temp1;
      	var temp2;
      	var input;
      	var result;

        var spriteManagerBadKnight = new BABYLON.SpriteManager("spriteManagerBadKnight","bad-knight.png", 1, {width: 320, height: 320}, scene);
        var spriteManagerBadArcher = new BABYLON.SpriteManager("spriteManagerBadArcher","bad-archer.png", 4, {width: 320, height: 320}, scene);
        var spriteManagerFire = new BABYLON.SpriteManager("spriteManagerFire","catapult-ammo.png", 20, {width: 320, height: 320}, scene);

        var badKnight1 = new BABYLON.Sprite("badKnight1", spriteManagerBadKnight);
        var badArcher1 = new BABYLON.Sprite("badArcher1", spriteManagerBadArcher);
        var badArcher2 = new BABYLON.Sprite("badArcher2", spriteManagerBadArcher);
        var badArcher3 = new BABYLON.Sprite("badArcher3", spriteManagerBadArcher);
        var badArcher4 = new BABYLON.Sprite("badArcher4", spriteManagerBadArcher);
        // var fire1 = new BABYLON.Sprite("fire1", spriteManagerFire);
        // var fire2 = new BABYLON.Sprite("fire2", spriteManagerFire);
        // var fire3 = new BABYLON.Sprite("fire3", spriteManagerFire);
        // var fire4 = new BABYLON.Sprite("fire4", spriteManagerFire);
        // var fire5 = new BABYLON.Sprite("fire5", spriteManagerFire);

        badKnight1.position.x =  0.02;
        badKnight1.position.y =  0.175;
        badArcher1.position.x = -4.25;
        badArcher1.position.y =  0.02;
        badArcher2.position.x =  4.25;
        badArcher2.position.y =  0.02;
        badArcher3.position.x = -8.0;
        badArcher3.position.y = -0.1;
        badArcher4.position.x =  8.0;
        badArcher4.position.y = -0.1;
        // fire1.position.x =  0.0;
        // fire1.position.y = 1.0;
        // fire2.position.x = -4.25;
        // fire2.position.y = 0.8;
        // fire3.position.x =  4.25;
        // fire3.position.y = 0.8;
        // fire4.position.x = -8.0;
        // fire4.position.y = 0.6;
        // fire5.position.x =  8.0;
        // fire5.position.y = 0.6;

        badKnight1.playAnimation(0, 11, true, 200);
        badArcher1.playAnimation(0, 11, true, 200);
        badArcher2.playAnimation(0, 11, true, 200);
        badArcher3.playAnimation(0, 11, true, 200);
        badArcher4.playAnimation(0, 11, true, 200);
        // fire1.playAnimation(0, 11, true, 200);
        // fire2.playAnimation(0, 11, true, 200);
        // fire3.playAnimation(0, 11, true, 200);
        // fire4.playAnimation(0, 11, true, 200);
        // fire5.playAnimation(0, 11, true, 200);

        // for (var i = 0; i < 20; i++) {
        //   var fire = new BABYLON.Sprite("fire", spriteManagerFire);
        //   fire.position.x = Math.random() * 10 - 5;
        //   fire.position.y = 0.2;
        //   fire.playAnimation(0, 11, true, 200);
        //   // tree.isPickable = true;
        // }

      	scene.actionManager = new BABYLON.ActionManager(scene);
        action = new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger, function(event) {

    			var key = event.sourceEvent.key;
    			console.log(key) ;

    			if (key == "Enter") {

    			       result = rand_num1 * input;
				if (result < temp1) {
					hitmarker_l.alpha = 1;
					setTimeout(function(){hitmarker_l.alpha = 0}, 2000);
				}
				else if ( result > temp2) {
					hitmarker_h.alpha = 1;
					setTimeout(function(){hitmarker_h.alpha = 0}, 2000);
				}
				else {
					hitmarker_t.alpha = 1;
					setTimeout(function(){hitmarker_t.alpha = 0}, 2000);
				}
    				output.text = result.toString();

          } else if (key == "a") {

            rand_num1 = Math.floor((Math.random() * 10) + 1);
            rand_num2 = Math.floor((Math.random() * 100) + 1);
            temp1 = rand_num1 * rand_num2;
            temp2 = rand_num1 * (rand_num2 + 3);

            text2.text = (rand_num1.toString()) + "  x  ";
            range.text = "[" + (temp1.toString()) + " , " + (temp2.toString()) + "]";
            output.text = "";
            text1.text = "";
            param = "";
            input = parseInt(param);

          } else if (key == "Backspace") {

    				param = param.substring(0, param.length - 1);
    				text1.text = param;
    				input = parseInt(param);

    			} else if (key == "0" || key == "1" || key == "2" || key == "3" || key == "4" ||
                     key == "5" || key == "6" || key == "7" || key == "8" || key == "9" ||
                     key == ".") {

    	      if(param.length < 3) {
              param += key;
      			  text1.text = param;
      	      input = parseInt(param);
            }

    			}

    			console.log(text1.text);
    			console.log(typeof param);
    			console.log(typeof input);

    		});
    		scene.actionManager.registerAction(action);

    		var button = BABYLON.GUI.Button.CreateImageWithCenterTextButton("log_butt", "Menu", "login-button.png");
    		button.height = "90px";
    		button.width = "290px";
    		button.fontFamily = "Blackadder ITC";
    		button.fontStyle = "italic";
    		button.fontSize = 36;
    		button.color = "gold";
    		button.thickness = 0;
    		advancedTexture.addControl(button);

    		button.top = "300px";
        button.left = "-600px"
        // button.left = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;

  			button.onPointerClickObservable.add(function() {
  				render = 1;
  			});

        var background = new BABYLON.Layer("back", "castle.png", scene);
    		background.isBackground = true;

    		return scene;

    	};

      // call the createLogin function
      var login_scene = createLogin();

      // call the createMenu function
      var menu_scene = createMenu();

      // call the createGame function
      var game_scene = createGame();

      // run the render loop
      engine.runRenderLoop(function(){

        switch(render) {
          case 0:
            login_scene.render();
            break;
          case 1:
            menu_scene.render();
            break;
          case 2:
            game_scene.render();
            break;
          default:
            login_scene.render()
            break;
        }

      });

      // the canvas/window resize event handler
      window.addEventListener('resize', function(){
          engine.resize();
      });

    });
  </script>
</body>
</html>
